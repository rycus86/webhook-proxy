ARG BASE_IMAGE="alpine"

FROM $BASE_IMAGE

LABEL maintainer "Viktor Adam <rycus86@gmail.com>"

RUN apk --no-cache add python3 py3-pip

ADD requirements.txt /tmp/requirements.txt
RUN pip install -r /tmp/requirements.txt

# required to install Docker dependencies
RUN apk --no-cache add docker-py docker-compose

ADD docker-requirements.txt /tmp/docker-requirements.txt
RUN pip install -r /tmp/docker-requirements.txt

ADD src /app
WORKDIR /app

ENV PYTHONUNBUFFERED=1

ENTRYPOINT [ "python", "app.py"]

# add app info as environment variables
ARG GIT_COMMIT
ENV GIT_COMMIT $GIT_COMMIT
